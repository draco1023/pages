<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <title>睿胜能效</title>
    <meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1.0">
    <meta name="author" content="Draco">
    <link rel="stylesheet" href="../wasion/jquery.fullPage.css">
    <link rel="stylesheet" href="../wasion/wasion.css">
</head>

<body>
    <div id="fullpage">
        <div class="section" id="section01"></div>
        <div class="section" id="section02"></div>
        <div class="section" id="section03"></div>
        <div class="section" id="section04"></div>
        <div class="section" id="section05"></div>
        <div class="section" id="section06"></div>
        <div class="section" id="section07"></div>
        <div class="section" id="section08"></div>
        <div class="section" id="section09"></div>
        <div class="section" id="section10"></div>
        <div class="section" id="section11"></div>
        <div class="section" id="section12"></div>
        <div class="section" id="section13"></div>
        <div class="section" id="section14"></div>
        <div class="section" id="section15"></div>
        <div class="section" id="section16"></div>
        <div class="section" id="section17"></div>
    </div>

    <script src="../wasion/jquery.min.js"></script>
    <!-- <script src="../wasion/jquery.easings.min.js"></script> -->
    <script src="../wasion/jquery.fullPage.min.js"></script>
    <script src="../wasion/snap.svg-min.js"></script>
    <script type="text/javascript">
    var flag = 0,
    jqCache = {},
    svgCache = {},
    states = {
    	'#path1-1': {
    		o: {
    			transform: 'translate(1280,200)',
            	'fill-opacity': 0
    		},
    		n: {
    			transform: 'translate(0,200)',
            	'fill-opacity': 1
    		}
    	},
    	'#text2-1': {
    		o: {
    			transform: 'translate(-300,0)',
            	'fill-opacity': 0
    		},
    		n: {
    			transform: 'translate(0,0)',
            	'fill-opacity': 1
    		}
    	},
    	'#text2-2': {
    		o: {
    			transform: 'translate(-300,0)',
            	'fill-opacity': 0
    		},
    		n: {
    			transform: 'translate(0,0)',
            	'fill-opacity': 1
    		}
    	},
    	'#g2-1': {
    		o: {
    			transform: 'translate(-100,0)',
            	'stroke-opacity': 0
    		},
    		n: {
    			transform: 'translate(0,0)',
            	'stroke-opacity': 1
    		}
    	},
    	'#text3-1': {
    		o: {
    			transform: 'translate(0,300)',
            	'fill-opacity': 0
    		},
    		n: {
    			transform: 'translate(0,0)',
            	'fill-opacity': 1
    		}
    	},
    	'#img3-1': {
    		o: {
    			transform: 'translate(0,500)',
    			opacity: 0
    		},
    		n: {
				transform: 'translate(0,0)',
				opacity: 1
    		}
    	},
    	'.text3-2': {
    		o: {
    			transform: 'scale(0)'
    		},
    		n: {
    			transform: 'scale(1)'
    		}
    	},
        '#text4-1': {
            o: {
                transform: 'translate(0,-200)',
                'fill-opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'fill-opacity': 1
            }
        },
        '#text4-2': {
            o: {
                transform: 'translate(0,-200)',
                'fill-opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'fill-opacity': 1
            }
        },
        '#text4-3': {
            o: {
                transform: 'translate(0,-200)',
                'fill-opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'fill-opacity': 1
            }
        },
        '#text4-4': {
            o: {
                transform: 'translate(0,-200)',
                'fill-opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'fill-opacity': 1
            }
        },
        '#img5-1': {
            o: {
                transform: 'translate(0,900)',
                'opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'opacity': 1
            }
        },
        '#img5-2': {
            o: {
                transform: 'translate(0,200)',
                'opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'opacity': 1
            }
        },
        '#img5-3': {
            o: {
                transform: 'translate(0,800)',
                'opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'opacity': 1
            }
        },
        '#img5-4': {
            o: {
                transform: 'translate(0,500)',
                'opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'opacity': 1
            }
        },
        '#img5-5': {
            o: {
                transform: 'translate(0,500)',
                'opacity': 0
            },
            n: {
                transform: 'translate(0,0)',
                'opacity': 1
            }
        },
        '#text5-1': {
            o: {
                transform: 'scale(0)'
            },
            n: {
                transform: 'scale(1) rotate(360, 384, 512)'
            }
        },
        '#text5-2': {
            o: {
                transform: 'scale(0)'
            },
            n: {
                transform: 'scale(1) rotate(360, 384, 512)'
            }
        },
        '#text5-3': {
            o: {
                transform: 'scale(0)'
            },
            n: {
                transform: 'scale(1) rotate(360, 384, 512)'
            }
        },
        '#text5-4': {
            o: {
                transform: 'scale(0)'
            },
            n: {
                transform: 'scale(1) rotate(360, 384, 512)'
            }
        }
    },
    components = [
    	['#path1-1'],
    	['#text2-1', '#g2-1', '#text2-2'],
    	['#text3-1', '#img3-1', '.text3-2'],
    	['#text4-1', '#text4-2', '#text4-3', '#text4-4'],
    	['#img5-1', '#img5-2', '#img5-3', '#img5-4', '#img5-5', '#text5-1', '#text5-2', '#text5-3', '#text5-4'],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[],
    	[]
	];

    function _(selector, isJquery) {
		var obj;
		if (isJquery) {
			obj = jqCache[selector];
			if (!obj) {
				obj = $(selector);
				jqCache[selector] = obj;
			}
		} else {
			obj = svgCache[selector];
			if (!obj) {
				obj = selector.indexOf(',') > -1 || selector.indexOf('.') === 0 ? Snap.selectAll(selector) : Snap.select(selector);
				svgCache[selector] = obj;
			}
		}
		return obj;
	}

	function loadSvg(index, loaded) {
		var i = index - 1,
		cur = flag;
		if (!(cur >> i & 1))
			Snap.load('../wasion/svg/' + index + '.svg?d=' + (+new Date), function(d) {
				this.appendChild(d.node);
				flag |= 1 << i;
				var comp = components[i];
				for (var j = 0, l = comp.length; j < l; j++)
					attr(comp[j]);
				loaded && loaded(d);
			}, _('.section', 1)[i]);
	}

	function attr(selector) {
		var els = _(selector);
		if (els.stop) {
			els.stop().attr(states[selector].o);
		} else {
			els.forEach(function(el){
				el.stop();
			}).attr(states[selector].o);
		}
	}

	function animate(selector, duration, ease, callback) {
		_(selector).animate(states[selector].n, duration || 1200, ease || mina.easeinout, callback);
	}

    $(function() {
    	var count = _('.section', 1).length,
    	preload = 4,
    	timeouts = [];

        $('#fullpage').fullpage({
        	verticalCentered: false,

            afterRender: function() {
            	loadSvg(1, function(d) {
        			animate('#path1-1');

	                for (var i = 1; i <= preload; i++)
	                	loadSvg(1 + i);
            	});
            },

            afterLoad: function(anchorLink, index) {
            	var preIndex = index + preload,
            	i = index - 1,
                comp = components[i];
            	if (preIndex <= count)
            		loadSvg(preIndex);

                // if (index == 1) {
                //     _('#path1-1').animate({
                //     	transform: 'translate(0,200)',
                //     	'fill-opacity': 1
                //     }, 1200, mina.easein);
                // } else if (index == 2) {
                // 	_('#text2-1, #g2-1').animate({
                // 		transform: 'translate(0,0)',
                // 		'fill-opacity': 1,
                // 		'stroke-opacity': 1
                // 	}, 1200, mina.easeinout);
                // 	var t = setTimeout(function() {
                // 		_('#text2-2').animate({
	               //  		transform: 'translate(0,0)',
	               //  		'fill-opacity': 1
	               //  	}, 1200, mina.easeinout, function() {
	               //  		_('#text2-3').animate({
		              //   		transform: 'translate(0,0)',
		              //   		'fill-opacity': 1
		              //   	}, 1200, mina.easeinout);
	               //  	});
                // 	}, 500);
                // 	timeouts.push(t);
                // }
                for (var j = 0, l = comp.length; j < l; j++) {
                	animate(comp[j]);
                };
            },

            onLeave: function(index, newIndex, direction) {
            	while (timeouts.length) {
            		clearTimeout(timeouts.pop());
            	}
                // if (index == 1 && direction == 'down') {
                // }
                var i = index - 1,
                comp = components[i];
                for (var j = 0, l = comp.length; j < l; j++) {
                	attr(comp[j]);
                };
            }
        });
    });
    </script>
</body>

</html>
