<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>机泵远程监测云平台</title>
    <meta name="description" content="resp pump">
    <meta name="keywords" content="pump">
    <meta name="author" content="Draco">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="assets/i/favicon.png">
    <link rel="stylesheet" href="assets/css/amazeui.min.css">
    <link rel="stylesheet" href="assets/css/other.css">
</head>

<body>
    <div class="am-page" id="main-view">
    <div data-am-widget="slider" class="am-slider am-slider-a1 main-slider" data-am-slider='{"directionNav":false,"controlNav":false,"animationLoop":false,"slideshow":false}'>
        <ul class="am-slides">
            <li>
                <div class="am-page">
                    <div class="logo2">
                        <img src="assets/i/resp.png"/>
                    </div>

                    <div class="block orange">
                        <div class="am-g">
                            <div class="am-u-sm-6 block-data">4.5</div>
                            <div class="am-u-sm-6 block-unit">kW</div>
                        </div>
                        <div class="block-title">监测水泵配用功率</div>
                    </div>

                    <div class="block blue">
                        <div class="am-g">
                            <div class="am-u-sm-6 block-data">2</div>
                            <div class="am-u-sm-6 block-unit">台</div>
                        </div>
                        <div class="block-title">远程监测水泵</div>
                    </div>

                    <div class="block cyan">
                        <div class="am-g">
                            <div class="am-u-sm-6 block-data">2</div>
                            <div class="am-u-sm-6 block-unit">个</div>
                        </div>
                        <div class="block-title">远程监测项目</div>
                    </div>

                    <div class="block darkblue">
                        <div class="am-g">
                            <div class="am-u-sm-6 block-data">2</div>
                            <div class="am-u-sm-6 block-unit">户</div>
                        </div>
                        <div class="block-title">远程服务客户</div>
                    </div>
                </div>
            </li>
            <li style="overflow-y:auto;">
                <table class="am-table am-table-centered">
                    <thead>
                        <tr>
                            <th>设备名</th>
                            <th>运行图</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3">
                                <table class="am-table am-table-centered project">
                                    <thead>
                                        <tr>
                                            <th colspan="3"><span>P</span>项目一</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="am-text-middle pump-index">1#</td>
                                            <td><img src="assets/i/pump-green.png" height="36" width="75"></td>
                                            <td class="am-text-middle">正常运行</td>
                                        </tr>
                                        <tr>
                                            <td class="am-text-middle pump-index">2#</td>
                                            <td><img src="assets/i/pump-red.png" height="36" width="75"></td>
                                            <td class="am-text-middle">超阀值运行</td>
                                        </tr>
                                        <tr>
                                            <td class="am-text-middle pump-index">3#</td>
                                            <td><img src="assets/i/pump-gray.png" height="36" width="75"></td>
                                            <td class="am-text-middle">停运</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td colspan="3">
                                <table class="am-table am-table-centered">
                                    <thead>
                                        <tr>
                                            <th colspan="3"><span>P</span>项目一</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="am-text-middle pump-index">1#</td>
                                            <td><img src="assets/i/pump-green.png" height="36" width="75"></td>
                                            <td class="am-text-middle">正常运行</td>
                                        </tr>
                                        <tr>
                                            <td class="am-text-middle pump-index">2#</td>
                                            <td><img src="assets/i/pump-red.png" height="36" width="75"></td>
                                            <td class="am-text-middle">超阀值运行</td>
                                        </tr>
                                        <tr>
                                            <td class="am-text-middle pump-index">3#</td>
                                            <td><img src="assets/i/pump-gray.png" height="36" width="75"></td>
                                            <td class="am-text-middle">停运</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </li>
        </ul>
    </div>
    </div>

    <div class="am-page" id="detail-view">
        <header data-am-widget="header" class="am-header am-header-default" style="border-bottom:1px solid #0CB8F6;">
            <span class="am-icon-chevron-left btn-back">返回</span>
            <h1 class="am-header-title" id="detail-header">XX项目 XX泵</h1>
        </header>
        <div class="prop-item text-blue am-cf">
            <div class="am-fr">数据时标：2015-11-09 16:45:00</div>
        </div>
        <div class="main-detail">
            <div class="prop-item">电力数据</div>
            <div class="am-g">
                <div class="am-u-sm-3 block-name">电&emsp;&emsp;压</div>
                <div class="am-u-sm-3 prop-block"><span>220</span><div class="am-fr">V</div></div>
                <div class="am-u-sm-3 block-name">电&emsp;&emsp;流</div>
                <div class="am-u-sm-3 prop-block"><span>0.00</span><div class="am-fr">A</div></div>
            </div>
            <div class="am-g detail-bottom">
                <div class="am-u-sm-3 block-name">有功功率</div>
                <div class="am-u-sm-3 prop-block"><span>0.02</span><div class="am-fr">kW</div></div>
                <div class="am-u-sm-3 block-name">功率因数</div>
                <div class="am-u-sm-3 prop-block"><span>1.00</span></div>
            </div>
            <div class="prop-item">泵体监测数据</div>
            <div class="am-g">
                <div class="am-u-sm-3 block-name">左轴承温度</div>
                <div class="am-u-sm-3 prop-block"><span>18.41</span><div class="am-fr">℃</div></div>
                <div class="am-u-sm-3 block-name">右轴承温度</div>
                <div class="am-u-sm-3 prop-block"><span>18.41</span><div class="am-fr">℃</div></div>
            </div>
            <div class="am-g">
                <div class="am-u-sm-3 block-name">储罐压力</div>
                <div class="am-u-sm-3 prop-block"><span class="zh">已断开</span><div class="am-fr">MPa</div></div>
                <div class="am-u-sm-3 block-name">泵出口压力</div>
                <div class="am-u-sm-3 prop-block"><span class="zh">已断开</span><div class="am-fr">MPa</div></div>
            </div>
            <div class="am-g">
                <div class="am-u-sm-3 block-name">系统流量</div>
                <div class="am-u-sm-3 prop-block"><span class="zh">已断开</span><div class="am-fr">m<sup>3</sup>/h</div></div>
                <div class="am-u-sm-3 block-name">轴承振动</div>
                <div class="am-u-sm-3 prop-block"><span class="zh">已断开</span><div class="am-fr">mm/s</div></div>
            </div>
            <div class="am-g detail-bottom">
                <div class="am-u-sm-3 block-name">储罐液位</div>
                <div class="am-u-sm-3 prop-block"><span class="zh">已断开</span><div class="am-fr">mm</div></div>
                <div class="am-u-sm-3 block-name">电&emsp;压&emsp;2</div>
                <div class="am-u-sm-3 prop-block"><span class="zh">已断开</span><div class="am-fr">V</div></div>
            </div>
        </div>
        <div class="am-g button-group">
            <div class="am-u-sm-4">
                <button class="am-btn am-btn-default am-radius am-btn-xs" data-prefix="prop">设计参数</button>
            </div>
            <div class="am-u-sm-4">
                <button class="am-btn am-btn-default am-radius am-btn-xs" data-prefix="threshold">监测阈值</button>
            </div>
            <div class="am-u-sm-4">
                <button class="am-btn am-btn-default am-radius am-btn-xs" data-prefix="chart">历史数据</button>
            </div>
        </div>
    </div>

    <div class="am-page" id="prop-view">
        <header data-am-widget="header" class="am-header am-header-default">
            <span class="am-icon-chevron-left btn-back">返回</span>
            <h1 class="am-header-title">铭牌参数</h1>
        </header>
        <div class="prop-separator"></div>
        <div class="prop-item am-cf no-bottom">
            <div class="am-fl">名称</div>
            <div class="am-fr"><span>XXXX泵</span></div>
        </div>
        <div class="prop-separator"></div>
        <div class="prop-item am-cf">
            <div class="am-fl">流量</div>
            <div class="am-fr"><span>10</span>&nbsp;m<sup>3</sup>/h</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">扬程</div>
            <div class="am-fr"><span>10</span>&nbsp;m</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">转速</div>
            <div class="am-fr"><span>2900</span>&nbsp;rpm</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">效率</div>
            <div class="am-fr"><span>85</span>&nbsp;%</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">轴功率</div>
            <div class="am-fr"><span>2.5</span>&nbsp;kW</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">配套功率</div>
            <div class="am-fr"><span>2.5</span>&nbsp;kW</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">汽蚀余量</div>
            <div class="am-fr"><span>4.0</span>&nbsp;m</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">泵重量</div>
            <div class="am-fr"><span>20</span>&nbsp;Kg</div>
        </div>
    </div>

    <div class="am-page" id="threshold-view">
        <header data-am-widget="header" class="am-header am-header-default">
            <span class="am-icon-chevron-left btn-back">返回</span>
            <h1 class="am-header-title">监测量阈值</h1>
        </header>
        <div class="prop-separator"></div>
        <div class="prop-item">电力数据</div>
        <div class="prop-separator narrow"></div>
        <div class="prop-item am-cf">
            <div class="am-fl">电压</div>
            <div class="am-fr"><span>220~223</span>&nbsp;V</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">电流</div>
            <div class="am-fr"><span>1~0</span>&nbsp;A</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">有功功率</div>
            <div class="am-fr"><span>0.01~0.02</span>&nbsp;A</div>
        </div>
        <div class="prop-item am-cf no-bottom">
            <div class="am-fl">功率因数</div>
            <div class="am-fr"><span>1~2</span>&nbsp;&ensp;</div>
        </div>
        <div class="prop-separator"></div>
        <div class="prop-item">泵体监测数据</div>
        <div class="prop-separator narrow"></div>
        <div class="prop-item am-cf">
            <div class="am-fl">左轴承温度</div>
            <div class="am-fr"><span>18.41~18.12</span>&nbsp;℃</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">右轴承温度</div>
            <div class="am-fr"><span>18.34~18.35</span>&nbsp;℃</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">储罐压力</div>
            <div class="am-fr"><span>已断开</span>&nbsp;MPa</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">泵出口压力</div>
            <div class="am-fr"><span>已断开</span>&nbsp;MPa</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">系统流量</div>
            <div class="am-fr"><span>已断开</span>&nbsp;m<sup>3</sup>/h</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">轴承振动</div>
            <div class="am-fr"><span>已断开</span>&nbsp;mm/s</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">储罐液位</div>
            <div class="am-fr"><span>已断开</span>&nbsp;mm</div>
        </div>
        <div class="prop-item am-cf">
            <div class="am-fl">电压2</div>
            <div class="am-fr"><span>已断开</span>&nbsp;MPa</div>
        </div>
    </div>

    <div class="am-page" id="chart-view">
        <header data-am-widget="header" class="am-header am-header-default" id="chart-header">
            <span class="am-icon-chevron-left btn-back">返回</span>
            <h1 class="am-header-title">详情</h1>
        </header>
    </div>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/amazeui.min.js"></script>
    <script src="assets/js/d3.min.js"></script>

    <script type="text/javascript">
    $(function() {
        $('body').on('click tap', '.project>tbody>tr', function() {
            $('body').addClass('detail-active');
            history.pushState(null, '', '#pump');
        });

        $('#detail-view .btn-back').on('click tap', function() {
            $('body').removeClass('detail-active');
            history.back();
        });

        $('#threshold-view .btn-back').on('click tap', function() {
            $('body').removeClass('threshold-active');
            history.back();
        });

        $('#chart-view .btn-back').on('click tap', function() {
            $('body').removeClass('chart-active');
            history.back();
        });

        $('#prop-view .btn-back').on('click tap', function() {
            $('body').removeClass('prop-active');
            history.back();
        });

        $('#detail-view button').on('click tap', function() {
            var prefix = $(this).data('prefix');
            $('body').addClass(prefix + '-active');
            history.pushState(null, '', '#' + prefix);
        });

        // d3
        var margin = {top: 30, right: 10, bottom: 30, left: 10},
            width = window.innerWidth - margin.left - margin.right - 20,
            height = 160 - margin.top - margin.bottom;

        var parseDate = d3.time.format("%d-%b-%y").parse;

        var x = d3.time.scale()
            .range([0, width]);

        var y = d3.scale.linear()
            .range([height, 0]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .ticks(3)
            .tickFormat(d3.time.format("%Y-%m-%d"))
            .orient("bottom");

        var line = d3.svg.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.rate); });

        var area = d3.svg.area()
          .x(function(d) { return x(d.date); })
          .y0(height)
          .y1(function(d) { return y(d.rate); });

        var svg = d3.select("#chart-view").append("svg")
            .attr("class", "svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

        svg.append("rect")
          .attr("class", "background")
          .attr("rx", "5px")
          .attr("ry", "5px")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom);

        svg = svg.append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var d3data = [['1-Jan-15','210.73'], ['1-Dec-14','196.97'], ['1-Nov-14','189.31'], ['1-Oct-14','180.86'], ['1-Sep-14','165.30'], ['1-Aug-14','166.43'], ['1-Jul-14','142.83'], ['1-Jun-14','139.35'], ['1-May-14','127.24'], ['1-Apr-14','108.69'], ['1-Mar-14','123.94'], ['1-Feb-14','155.51'], ['1-Jan-14','128.35'], ['1-Dec-13','120.93'], ['1-Nov-13','106.96'], ['1-Oct-13','109.12'], ['1-Sep-13','166.19'], ['1-Aug-13','156.66'], ['1-Jul-13','174.68'], ['1-Jun-13','186.10'], ['1-May-13','180.00'], ['1-Apr-13','149.53'], ['1-Mar-13','121.73'], ['1-Feb-13','133.75'], ['1-Jan-13','194.84'], ['1-Dec-12','178.86'], ['1-Nov-12','187.44'], ['1-Oct-12','156.34'], ['1-Sep-12','144.16'], ['1-Aug-12','135.00'], ['1-Jul-12','121.26'],['1-Jun-12', '118.4']];

                var data = [];
                  d3data.forEach(function(d) {
                    data.push({
                        date : parseDate(d[0]),
                        rate : +d[1]
                    });
                  });

          var maxValue = d3.max(data, function(d) { return d.rate; }) + 50,
            minValue = d3.min(data, function(d) { return d.rate; }) - 50;

          x.domain(d3.extent(data, function(d) { return d.date; }));
          y.domain([minValue, maxValue]);

          svg.append("linearGradient")
            .attr("id", "background-gradient")
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("x1", 0).attr("y1", 0)
            .attr("x2", 0).attr("y2", height)
          .selectAll("stop")
            .data([
              {offset: "0%", color: "#5CD1FC"},
              {offset: "100%", color: "#0CB8F6"}
            ])
          .enter().append("stop")
            .attr("offset", function(d) { return d.offset; })
            .attr("stop-color", function(d) { return d.color; });

          svg.append("linearGradient")
            .attr("id", "area-gradient")
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("x1", 0).attr("y1", y(0))
            .attr("x2", 0).attr("y2", y(d3.max(data, function(d) { return d.rate; })))
          .selectAll("stop")
            .data([
              {offset: "40%", color: "#fff", opacity: "0%"},
              {offset: "100%", color: "#fff", opacity: "30%"}
            ])
          .enter().append("stop")
            .attr("offset", function(d) { return d.offset; })
            .attr("stop-color", function(d) { return d.color; })
            .attr("stop-opacity", function(d) { return d.opacity; });

          svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(" + (-35) + "," + height + ")")
              .call(xAxis);

          svg.append("path")
              .datum(data)
              .attr("class", "line")
              .attr("d", line);

          svg.append("path")
              .datum(data)
              .attr("class", "area")
              .attr("d", area);

            var sd = [];
            for (var i = 0; i < data.length; i+=3) {
                sd.push(data[i]);
            };

          svg.append("g").attr("class", "scatter")
            .selectAll("circle")
            .data(sd)
            .enter().append("circle")
            .attr("class", "dot")
            .attr("cx", function(d) {
                  return x(d.date);
             })
             .attr("cy", function(d) {
                  return y(d.rate);
             })
             .attr("r", 3);

          svg.append("g").selectAll("line")
            .data([
              {y1: y(minValue), y2: y(minValue), x1: 0, x2: width},
              {y1: y((maxValue+minValue)/2), y2: y((maxValue+minValue)/2), x1: 0, x2: width},
              {y1: y(maxValue), y2: y(maxValue), x1: 0, x2: width},

            ])
          .enter().append("line")
            .attr("class", "date-line")
            .attr("y1", function(d) { return d.y1; })
            .attr("y2", function(d) { return d.y2; })
            .attr("x1", function(d) { return d.x1; })
            .attr("x2", function(d) { return d.x2; });

          svg.append("g").selectAll("text")
            .data([
              {text: d3.round(minValue, 0), x: width, y: y(minValue) - 5, anchor: "end", labelClass: "label-small"},
              {text: d3.round(maxValue, 0), x: width, y: y(maxValue) + 15, anchor: "end", labelClass: "label-small"},
              // {text: "Daily Avg: " + d3.round(d3.mean(data ,function (d) { return d.rate}), 0), x: 0, y: y(maxValue) - 5, anchor: "start", labelClass: "label-small"},
              {text: "XX项目XX泵", x: 0, y: y(maxValue) - 5, anchor: "start", labelClass: "label-large"},
              {text: d3.round(data[0].rate, 0) + "cal", x: width, y: y(maxValue) - 5, anchor: "end", labelClass: "label-large"},
              // {text: "Today", x: width, y: y(maxValue) - 5, anchor: "end", labelClass: "label-small"}
            ])
          .enter().append("text")
            .attr("class", function(d) { return d.labelClass; })
            .text(function(d) { return d.text; })
            .attr("x", function(d) { return d.x; })
            .attr("y", function(d) { return d.y; })
            .attr("text-anchor", function(d) { return d.anchor; });

  // svg.append("path")
  //     .attr("d", d3.svg.symbol()
  //       .size(function(d) { return 400; })
  //       .type(function(d) { return "triangle-up"; }))
  //     .attr("class", "icon")
  //     .attr("transform", "translate(" + 25 + "," + (-20) + ")");

    });
    </script>
</body>

</html>
